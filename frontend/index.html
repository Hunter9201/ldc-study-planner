<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Countdown — LDC Study Planner</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body { 
    background-color: #f8fafc; 
    font-family: 'Inter', sans-serif;
    transition: background-color 0.3s, color 0.3s;
    overflow-x: hidden;
  }
  .progress-bar { 
    height: 10px; 
    border-radius: 6px; 
    background: #e5e7eb; 
    overflow: hidden; 
  }
  .progress-inner { 
    height: 100%; 
    background: linear-gradient(to right, #4f46e5, #9333ea); 
    transition: width 0.5s ease; 
  }
  .dark-mode { 
    background-color: #1f2937; 
    color: #f9fafb; 
  }
  .dark-mode .bg-white { 
    background-color: #374151 !important; 
    color: #f9fafb; 
  }
  .dark-mode input, .dark-mode select, .dark-mode textarea { 
    background-color: #4b5563; 
    color: #f9fafb; 
    border-color: #6b7280; 
  }
  .dark-mode .border-gray-200 {
    border-color: #4b5563;
  }
  .subject-card {
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .subject-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }
  .completed {
    text-decoration: line-through;
    opacity: 0.7;
  }
  .login-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  .login-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    padding: 2rem;
    width: 100%;
    max-width: 400px;
  }
  .hidden {
    display: none !important;
  }
  .auth-error {
    background: #fee2e2;
    border: 1px solid #fecaca;
    color: #dc2626;
    padding: 0.75rem;
    border-radius: 0.5rem;
    margin-bottom: 1rem;
  }
</style>
</head>
<body class="min-h-screen">

<!-- Login Screen -->
<div id="loginScreen">
  <div class="login-container">
    <div class="login-card">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-indigo-700 mb-2"><i class="fas fa-book mr-2"></i>THE COUNTDOWN</h1>
        <p class="text-gray-600">Your Ultimate LDC Study Planner</p>
      </div>
      
      <div id="loginForm">
        <h2 class="text-xl font-semibold text-center mb-6">Welcome Back!</h2>
        
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-medium mb-2">Email</label>
          <input id="loginEmail" type="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="your@email.com">
        </div>
        
        <div class="mb-6">
          <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
          <input id="loginPassword" type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="••••••••">
        </div>
        
        <button id="loginBtn" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-medium hover:bg-indigo-700 transition-colors mb-4">
          Sign In
        </button>
        
        <div class="text-center">
          <button id="showRegister" class="text-indigo-600 hover:text-indigo-800 text-sm">
            Don't have an account? Sign up
          </button>
        </div>
      </div>
      
      <div id="registerForm" class="hidden">
        <h2 class="text-xl font-semibold text-center mb-6">Create Account</h2>
        
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-medium mb-2">Full Name</label>
          <input id="registerName" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="John Doe">
        </div>
        
        <div class="mb-4">
          <label class="block text-gray-700 text-sm font-medium mb-2">Email</label>
          <input id="registerEmail" type="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="your@email.com">
        </div>
        
        <div class="mb-6">
          <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
          <input id="registerPassword" type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="••••••••">
        </div>
        
        <button id="registerBtn" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-medium hover:bg-indigo-700 transition-colors mb-4">
          Create Account
        </button>
        
        <div class="text-center">
          <button id="showLogin" class="text-indigo-600 hover:text-indigo-800 text-sm">
            Already have an account? Sign in
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Application -->
<div id="appContainer" class="hidden">
  <header class="bg-gradient-to-r from-indigo-700 to-purple-700 text-white py-4 shadow-md">
    <div class="max-w-6xl mx-auto px-6 flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-extrabold"><i class="fas fa-book mr-2"></i>THE COUNTDOWN</h1>
        <p class="text-xs opacity-90">Your Ultimate LDC Study Planner</p>
      </div>
      
      <div class="flex items-center space-x-4">
        <span id="userName" class="font-medium">User</span>
        <button id="logoutBtn" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
          <i class="fas fa-sign-out-alt mr-2"></i>Logout
        </button>
      </div>
    </div>
  </header>

  <main class="flex-1 max-w-6xl mx-auto p-6">
    <!-- Countdown -->
    <section class="mb-8 text-center bg-gradient-to-br from-white to-indigo-50 rounded-2xl shadow-md p-6 border border-indigo-100">
      <h2 class="text-2xl font-semibold text-gray-800 mb-2"><i class="fas fa-clock mr-2"></i>Time Remaining</h2>
      <div id="countdown" class="text-4xl font-bold text-red-600 mb-1">Loading...</div>
      <p id="scareText" class="text-gray-600 italic">Get ready, Counsel!</p>
    </section>

    <!-- Progress -->
    <section class="bg-white rounded-2xl shadow-md p-6 mb-8">
      <h2 class="text-xl font-semibold text-indigo-700 mb-4"><i class="fas fa-chart-line mr-2"></i>Overall Progress</h2>
      <div class="progress-bar mb-2">
        <div id="progressBar" class="progress-inner" style="width:0%;"></div>
      </div>
      <p id="progressText" class="text-sm text-gray-600 text-right">0% Completed</p>
    </section>

    <!-- Study Subjects -->
    <section class="bg-white rounded-2xl shadow-md p-6 mb-8">
      <h2 class="text-xl font-semibold text-indigo-700 mb-4"><i class="fas fa-graduation-cap mr-2"></i>Study Subjects</h2>
      <div id="subjectsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Subjects will be loaded here -->
      </div>
    </section>

    <!-- Study Plan -->
    <section class="bg-white rounded-2xl shadow-md p-6">
      <h2 class="text-xl font-semibold text-indigo-700 mb-4"><i class="fas fa-calendar-alt mr-2"></i>Your Study Plan</h2>
      <div id="studyPlanContainer">
        <p class="text-gray-600">Your study sessions will appear here...</p>
      </div>
    </section>
  </main>
</div>

<script>
// === CONFIGURATION ===
const API_BASE = 'https://ldc-study-planner.vercel.app/api';

// Sample study data
const studySubjects = [
  { id: 1, name: "Civil Proceedings", completed: false },
  { id: 2, name: "Criminal Proceedings", completed: false },
  { id: 3, name: "Family Law Practice", completed: false },
  { id: 4, name: "Corporate & Commercial Practice", completed: false },
  { id: 5, name: "Land Practice", completed: false }
];

let currentUser = null;
let userProgress = {};
let studyPlan = [];

// === API FUNCTIONS ===
async function registerUser(name, email, password) {
    try {
        const response = await fetch(API_BASE + '/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                username: email, 
                password: password, 
                email: email, 
                full_name: name 
            })
        });
        return await response.json();
    } catch (error) {
        console.error('Registration error:', error);
        return { success: false, error: 'Network error' };
    }
}

async function loginUser(email, password) {
    try {
        const response = await fetch(API_BASE + '/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: email, password: password })
        });
        return await response.json();
    } catch (error) {
        console.error('Login error:', error);
        return { success: false, error: 'Network error' };
    }
}

async function saveUserData(studentId, progress, studyPlan) {
    try {
        const response = await fetch(API_BASE + '/save-data', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ studentId, progress, studyPlan })
        });
        return await response.json();
    } catch (error) {
        console.error('Save error:', error);
        return { success: false, error: 'Network error' };
    }
}

// === AUTH FUNCTIONS ===
function showAuthError(message, formId) {
  removeAuthErrors();
  const errorEl = document.createElement('div');
  errorEl.className = 'auth-error';
  errorEl.textContent = message;
  const currentForm = document.getElementById(formId);
  currentForm.insertBefore(errorEl, currentForm.firstChild);
}

function removeAuthErrors() {
  const existingErrors = document.querySelectorAll('.auth-error');
  existingErrors.forEach(error => error.remove());
}

async function handleRegister() {
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    
    if (!name || !email || !password) {
        showAuthError('Please fill in all fields', 'registerForm');
        return;
    }
    
    if (password.length < 6) {
        showAuthError('Password must be at least 6 characters long', 'registerForm');
        return;
    }
    
    const result = await registerUser(name, email, password);
    
    if (result.success) {
        const loginResult = await loginUser(email, password);
        if (loginResult.success) {
            currentUser = loginResult.student;
            userProgress = loginResult.progress || {};
            studyPlan = loginResult.studyPlan || [];
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showApp();
        }
    } else {
        showAuthError(result.error, 'registerForm');
    }
}

async function handleLogin() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    if (!email || !password) {
        showAuthError('Please enter both email and password', 'loginForm');
        return;
    }
    
    const result = await loginUser(email, password);
    
    if (result.success) {
        currentUser = result.student;
        userProgress = result.progress || {};
        studyPlan = result.studyPlan || [];
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        showApp();
    } else {
        showAuthError(result.error, 'loginForm');
    }
}

function handleLogout() {
    currentUser = null;
    userProgress = {};
    studyPlan = [];
    localStorage.removeItem('currentUser');
    showLogin();
}

// === UI FUNCTIONS ===
function showLogin() {
    document.getElementById('loginScreen').classList.remove('hidden');
    document.getElementById('appContainer').classList.add('hidden');
    removeAuthErrors();
}

function showApp() {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('appContainer').classList.remove('hidden');
    
    // Update UI with user data
    document.getElementById('userName').textContent = currentUser.full_name || currentUser.username;
    
    // Load user data
    loadSubjects();
    updateProgress();
    updateCountdown();
    loadStudyPlan();
    
    // Start auto-save
    setupAutoSave();
}

function loadSubjects() {
    const container = document.getElementById('subjectsContainer');
    container.innerHTML = '';
    
    studySubjects.forEach(subject => {
        const isCompleted = userProgress[`subject_${subject.id}`] === true;
        
        const subjectEl = document.createElement('div');
        subjectEl.className = 'flex items-center p-4 border border-gray-200 rounded-lg subject-card';
        subjectEl.innerHTML = `
            <input type="checkbox" id="subject-${subject.id}" ${isCompleted ? 'checked' : ''} 
                   class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 mr-3">
            <label for="subject-${subject.id}" class="flex-1 ${isCompleted ? 'completed' : ''}">
                ${subject.name}
            </label>
        `;
        
        const checkbox = subjectEl.querySelector('input');
        checkbox.addEventListener('change', async () => {
            userProgress[`subject_${subject.id}`] = checkbox.checked;
            const label = subjectEl.querySelector('label');
            if (checkbox.checked) {
                label.classList.add('completed');
            } else {
                label.classList.remove('completed');
            }
            updateProgress();
            
            // Auto-save
            if (currentUser) {
                await saveUserData(currentUser.id, userProgress, studyPlan);
            }
        });
        
        container.appendChild(subjectEl);
    });
}

function updateProgress() {
    const total = studySubjects.length;
    const completed = studySubjects.filter(subject => 
        userProgress[`subject_${subject.id}`] === true
    ).length;
    
    const percent = Math.round((completed / total) * 100);
    document.getElementById('progressBar').style.width = percent + '%';
    document.getElementById('progressText').textContent = 
        `${completed}/${total} Subjects (${percent}%) Completed`;
}

function updateCountdown() {
    const deadline = new Date('2025-12-07T23:59:59');
    const now = new Date();
    const diff = deadline - now;
    
    if (diff <= 0) {
        document.getElementById('countdown').textContent = "EXAMS HAVE BEGUN!";
        document.getElementById('scareText').textContent = "All the best, Counsel!";
        return;
    }
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((diff / (1000 * 60)) % 60);
    
    document.getElementById('countdown').textContent = `${days}d ${hours}h ${minutes}m left`;
    
    const scareSayings = [
        "⏳ Time is slipping away!",
        "🔥 Every second counts!",
        "😱 Your exams are almost here!",
        "💼 Only the prepared will pass!",
        "⚖️ Justice favors the diligent!"
    ];
    document.getElementById('scareText').textContent = 
        scareSayings[Math.floor(Math.random() * scareSayings.length)];
}

function loadStudyPlan() {
    const container = document.getElementById('studyPlanContainer');
    
    if (studyPlan.length === 0) {
        container.innerHTML = `
            <div class="text-center py-8">
                <i class="fas fa-calendar-plus text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-600">No study sessions planned yet.</p>
                <button onclick="addSamplePlan()" class="mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                    Add Sample Study Plan
                </button>
            </div>
        `;
        return;
    }
    
    let html = '<div class="space-y-4">';
    studyPlan.forEach((session, index) => {
        html += `
            <div class="p-4 border border-gray-200 rounded-lg">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="font-semibold">${session.subject}</h3>
                        <p class="text-sm text-gray-600">${new Date(session.date).toLocaleDateString()} • ${session.duration}h</p>
                    </div>
                    <button onclick="removeSession(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
    });
    html += '</div>';
    container.innerHTML = html;
}

function addSamplePlan() {
    const samplePlan = [
        { subject: "Civil Proceedings", date: new Date().toISOString(), duration: 2 },
        { subject: "Criminal Proceedings", date: new Date(Date.now() + 86400000).toISOString(), duration: 1.5 },
        { subject: "Family Law Practice", date: new Date(Date.now() + 172800000).toISOString(), duration: 2 }
    ];
    
    studyPlan = samplePlan;
    loadStudyPlan();
    
    // Auto-save
    if (currentUser) {
        saveUserData(currentUser.id, userProgress, studyPlan);
    }
}

function removeSession(index) {
    studyPlan.splice(index, 1);
    loadStudyPlan();
    
    // Auto-save
    if (currentUser) {
        saveUserData(currentUser.id, userProgress, studyPlan);
    }
}

function setupAutoSave() {
    setInterval(async () => {
        if (currentUser) {
            await saveUserData(currentUser.id, userProgress, studyPlan);
            console.log('Auto-saved to server');
        }
    }, 120000); // Every 2 minutes
}

// === INITIALIZATION ===
function init() {
    // Check if user is already logged in
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showApp();
    } else {
        showLogin();
    }
    
    // Set up event listeners
    document.getElementById('loginBtn').addEventListener('click', handleLogin);
    document.getElementById('registerBtn').addEventListener('click', handleRegister);
    document.getElementById('showRegister').addEventListener('click', () => {
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('registerForm').classList.remove('hidden');
        removeAuthErrors();
    });
    document.getElementById('showLogin').addEventListener('click', () => {
        document.getElementById('registerForm').classList.add('hidden');
        document.getElementById('loginForm').classList.remove('hidden');
        removeAuthErrors();
    });
    document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    
    // Allow Enter key in forms
    document.getElementById('loginEmail').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleLogin();
    });
    document.getElementById('loginPassword').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleLogin();
    });
    document.getElementById('registerName').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleRegister();
    });
    document.getElementById('registerEmail').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleRegister();
    });
    document.getElementById('registerPassword').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleRegister();
    });
    
    // Start countdown timer
    setInterval(updateCountdown, 60000); // Update every minute
}

// Start the app when page loads
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
